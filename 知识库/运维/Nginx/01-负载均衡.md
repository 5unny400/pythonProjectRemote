# Nginx实现负载均衡

### upstream模块实现负载均衡 -> vim /IT_zhengqing/soft/nginx_test/conf/nginx.conf

```
upstream test { 
    server 47.96.154.250:80;
    server 47.96.154.250:81;
}
server {
    ....
    location  ~*^.+$ {         
        proxy_pass  http://test;  #请求转向test 定义的服务器列表         
    }
}
```

### 1、热备：如果你有2台服务器，当一台服务器发生事故时，才启用第二台服务器给提供服务。服务器处理请求的顺序：AAAAAA突然A挂啦，BBBBBBBBBBBBBB.....

```
upstream mysvr { 
    server 127.0.0.1:7878; 
    server 47.96.154.250:3333 backup;  #热备     
}
```

### 2、轮询：nginx默认就是轮询其权重都默认为1，服务器处理请求的顺序：ABABABABAB....

```
upstream mysvr { 
    server 127.0.0.1:7878;
    server 47.96.154.250:3333;       
}
```

### 3、加权轮询：跟据配置的权重的大小而分发给不同服务器不同数量的请求。如果不设置，则默认为1。下面服务器的请求顺序为：ABBABBABBABBABB....

```
upstream mysvr { 
    server 127.0.0.1:7878 weight=1;
    server 47.96.154.250:3333 weight=2;
}
```

### 4、ip_hash:nginx会让相同的客户端ip请求相同的服务器。

```
upstream mysvr { 
    server 127.0.0.1:7878; 
    server 47.96.154.250:3333;
    ip_hash;
}
```

举例:

```
user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}

http {
  	upstream demo { 
    	server 47.96.154.250:81;
    	server 47.96.154.250:9527;
    	# ip_hash; # ip_hash:nginx会让相同的客户端ip请求相同的服务器
	}
	server {
        listen 80;
    	server_name  www.wanghongmei.online;
        location / {
            proxy_pass http://demo; #请求转向demo 定义的服务器列表   
        }
    }
    # include /etc/nginx/conf.d/*.conf;
}
```