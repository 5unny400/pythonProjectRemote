# Java - 集合方法系列

### StringJoiner类 -> 际上是运用了StringBuilder的一个拼接字符串的封装处理

```java
StringJoiner sj=new StringJoiner(":","[","]");
        sj.add("George").add("Sally").add("Fred");
        String desiredString=sj.toString();

        代码输出为[George:Sally:Fred]
```

### 字符串每隔10个字换行

```java
String str="[标准][不要苦的][辣一点][微微甜][标准吧吧][不要苦的][辣一点][微微甜]";
        log.info("{}",str.replaceAll("(.{10})","$1\n"));
```

### String.join 字符串拼接 数组array或集合list

```java
List names=new ArrayList<String>();
        names.add("1");
        names.add("2");
        names.add("3");
        System.out.println(String.join("-",names));

        String[]arrStr=new String[]{"a","b","c"};
        System.out.println(String.join("-",arrStr));

        输出：
        1-2-3
        a-b-c

        ex:String departmentIds=String.join(",",input.getDepartmentIds());
```

### list 转 逗号分隔字符串

```
import com.google.common.base.Joiner;

Joiner.on(",").join(list)
```

### 将以 `,` 拼接的字符串id 拆分成数组

> “.”和“|”都是转义字符，必须得加"\\";

```java
String[]strArray=str.split(",");
        String[]strArray=str.split("\\*");// 注：*是特殊字符需转义
```

### 判断一个list 或 数组非空

```java
list!=null&&!list.isEmpty()
```

### java中逗号分隔的字符串和List相互转换

1. 将逗号分隔的字符串转换为List

```
// 字符型
String str = "a,b,c";
List<String> result = Arrays.asList(str.split(","));

// 数字型
String ids = "1,2,3,4,5,6";
List<Long> listIds = Arrays.stream(ids.split(",")).map(s -> Long.parseLong(s.trim())).collect(Collectors.toList());
//        List<Integer> idList = Arrays.asList(ids.split(",")).stream().map(str -> Integer.parseInt(str.trim())).collect(Collectors.toList());
System.out.println(Arrays.toString(listIds.toArray()));//[1,2,3,3,4,5,6]
```

2. 将List转换为逗号分隔的字符串

```
List<Integer> numList = Lists.newArrayList(1, 2, 3, 4, 5, 6);
String nums = Joiner.on(",").join(numList);
System.out.println(nums); // 1,2,3,4,5,6



（1） 利用Guava的Joiner
    List<String> list=new ArrayList<String>();
    list.add("a");
    list.add("b");
    list.add("c");
    String str=Joiner.on(",").join(list);

    （2）利用Apache Commons的StringUtils
    List<String> list=new ArrayList<String>();
    list.add("a");
    list.add("b");
    list.add("c");
    String str=StringUtils.join(list.toArray(),",");

    （3）java8
    String str=list.stream().map(User::getRealName).collect(Collectors.joining(","))
```

### 反转list数据

```java
Collections.reverse(list);
```

### Java中List循环遍历的时候删除当前遍历对象

```java
public class Test {

    public static void main(String args[]) {
        List<String> list = new ArrayList<String>();
        list.add("a");
        list.add("b");
        list.add("b");
        list.add("c");
        list.add("b");
        Iterator<String> iter = list.iterator();
        while (iter.hasNext()) {
            String s = iter.next();
            if (s.equals("b")) {
                iter.remove();
            }
        }
        System.out.println(list);
    }
}

// 如果在forEach里面 则 appContaminateOrFineDayList.removeIf(e -> e.getStationId() == 6);
```

### java合并两个数组，同时使合并的数组中不包含重复的元素 -> 利用TreeSet有序且不重复的特点

```java
public class Test {

    /**
     * 数组合并 
     */
    public static void main(String args[]) {
        Integer[] arr1 = {1, 2, 3};
        Integer[] arr2 = {1, 3, 5};
        TreeSet<String> set = new TreeSet<>();
        set.addAll(Arrays.asList(arr1)); // 将数组转为集合
        set.addAll(Arrays.asList(arr2));
        Integer[] arr = set.toArray(new Integer[set.size()]);
        System.out.println(arr);
    }
}
```

ex：案例demo

```
if(input.getCarIds()!=null){
    TreeSet<String> set = new TreeSet<>();
    if ( planResource.getCarIds() !=null ){
        set.addAll( Arrays.asList( planResource.getCarIds().split(",") ) );
    }
    set.addAll( Arrays.asList( input.getCarIds().split(",") ) );
    String[] carIds = set.toArray(new String[set.size()]);
    planResource.setCarIds( String.join( ",", carIds ) );
}
```

### BeanUtils的使用

利用BeanUtils提供的copyProperties可以实现实体类数据的复制

坑01：只用属性名和属性类型一致的部分才可以进行复制操作，例如 BeanUtils.copyProperties(girlFormModel, girlModel);
代码解释：将girlFormModel对象复制给girlModel对象

### java8中List根据某一字段去重

```java
// 根据项目名称去重 【注】 需重新赋值
result=list.stream().collect(Collectors.collectingAndThen(Collectors.toCollection(()->new TreeSet<>(Comparator.comparing(Project::getName))),ArrayList::new));
```

# JDK 1.8 Lambda表达式集合分组、条件过滤、组装、去重、排序、转换、求和、最值

> 前提: (List<User> userList不为空)

#### 1、通过指定字段分组Collectors.groupingBy().

```
Map<String, List<User>> groupByStatus = userList.stream().collect(Collectors.groupingBy(User::getStatus));
for (Map.Entry<String, List<User>> entry : groupByStatus.entrySet()) {
            String status = entry.getKey();
            List<User> userList = entry.getValue();
}
```

#### 2、通过条件过滤filter().

```
List<User> userListByStatus = list.stream().filter(e -> e.getStatus().equals("100")).collect(Collectors.toList());
```

#### 3、获取list某个字段组装新list.

```
List<Integer> userIdList = userList.stream().map(e -> e.getUserId()).collect(Collectors.toList());
```

#### 4、去重distinct().

```
List<Long> userIdList = userList.stream().distinct().collect(Collectors.toList());

// 根据指定字段userid去重
userList = userList.stream().collect(Collectors.collectingAndThen(Collectors.toCollection(() -> new TreeSet<>(Comparator.comparing(User :: getUserid))), ArrayList::new));
```

#### 7、求和

```
基本类型：int sumAge = userList.stream().mapToInt(User::getAge).sum();
其他：BigDecimal totalMemberNum = userList.stream().map(User::getMemberNum).reduce(BigDecimal.ZERO, BigDecimal::add); //（其中，若bigDecimal对象为null，可filter()过滤掉空指针.）
```

#### 8、最值

```
Date minDate = userList.stream().map(User::getCreateTime).min(Date::compareTo).get();
Date maxDate = userList.stream().map(User::getCreateTime).max(Date::compareTo).get();
User maxUp = userList.stream().max(Comparator.comparingInt(User::getAge)).get();
```

#### 10、求差值（新增、删除）

```
List<Integer> userIdListNew = Lists.newArrayList(1, 2, 3, 5, 6);
List<Integer> userIdListOld = Lists.newArrayList(1, 2, 3, 4);

// 删除人员 [4]
List<Integer> removeUserIdList = userIdListOld.stream().filter(userIdOld -> !userIdListNew.contains(userIdOld)).collect(Collectors.toList());

// 新增人员 [5, 6]
List<Integer> addUserIdList = userIdListNew.stream().filter(userIdNew -> !userIdListOld.contains(userIdNew)).collect(Collectors.toList());
```

#### 11、list对象转Map<String, List<对象>>

```
Map<String, List<SysDictVO>> map = Maps.newHashMap();
List<SysDictVO> list = this.list();
if (CollectionUtils.isEmpty(list)) {
    return map;
}
for (SysDictVO item : list) {
    map.computeIfAbsent(item.getCode(), k -> new LinkedList<>()).add(item);
}
```

#### 12、求list重复元素值

```
@Test // 求重复元素值
public void test02() throws Exception {
    List<Integer> list = Lists.newArrayList(1, 2, 3, 4, 5, 6, 1, 6, 6);
    List<Integer> repeatDataList = list.stream().
    collect(Collectors.toMap(e -> e, e -> 1, Integer::sum))
    .entrySet().stream()
    .filter(entry -> entry.getValue() > 1)
    .map(Map.Entry::getKey)
    .collect(Collectors.toList());
    System.out.println(repeatDataList); // [1, 6]
    
    
    // 求list对象中某一个字段的重复值
    List<String> repeatValueDataList = dictList
                    .stream().map(e -> e.getValue()).collect(Collectors.toList())
                    .stream().collect(Collectors.toMap(e -> e, e -> 1, Integer::sum))
                    .entrySet().stream()
                    .filter(entry -> entry.getValue() > 1)
                    .map(Map.Entry::getKey)
                    .collect(Collectors.toList());
}


public <T> List<T> getRepeatDataList(List<T> list) {
    return list.stream()
            // 获得元素出现频率的 Map，键为元素，值为元素出现的次数
            .collect(Collectors.toMap(e -> e, e -> 1, Integer::sum))
            // Set<Entry>转换为Stream<Entry>
            .entrySet().stream()
            // 过滤出元素出现次数大于 1 的 entry
            .filter(entry -> entry.getValue() > 1)
            // 获得 entry 的键（重复元素）对应的 Stream
            .map(Entry::getKey)
            // 转化为 List
            .collect(Collectors.toList());
}
```

### 判断数组中是否包含某个指定元素

```
// 使用ArrayUtils
public static boolean useArrayUtils(String[] arr,String targetValue){
    return ArrayUtils.contains(arr,targetValue);
}
```

### Java找出2个集合相同和不同的元素 ->  可参考：https://blog.csdn.net/qq_29347295/article/details/78630109

```
list2.removeAll(list1); // -> 求出的结果是 list2中有的但list1中没有
System.out.println("list2中不存在于list1中的："+list2);
list2X.removeAll(list2); // list2X值与排除前的list2值相等
System.out.println("list2中存在于list1中的："+list2);
```

### 遍历map

```
map.forEach((k, v) -> System.out.println("key:value = " + k + ":" + v));
```

### map转list

```
map.entrySet().stream().map(e -> new Person(e.getKey(),e.getValue())).collect(Collectors.toList());
```

### list转map

```
Map<Integer, String> result1 = list.stream().collect(
                Collectors.toMap(Hosting::getId, Hosting::getName));
```

### list分类统计数量

```
// 多字段统计
Map<String, Map<Integer, Long>> map = list.stream().collect(Collectors.groupingBy(User::getUserName,Collectors.groupingBy(User::getAge,Collectors.counting())));

// 单字段统计 【Collectors.summarizingLong方法中：包含总数，和，平均值等信息】
Map<String, LongSummaryStatistics> collect = list.stream().
                    collect(Collectors.groupingBy(MonitorTask::getType, Collectors.summarizingLong(MonitorTask::getMonitorTaskId)));
```

### Java判断List中是否有重复元素

```
// 1.将List转为Set，通过2个集合的size大小是否相等来判断有无重复元素
public static void main(String[] args) {
    List<String> stringList=new ArrayList<>(Arrays.asList("a","a","b","c"));
    Set<String> stringSet=new HashSet<>(stringList);
    if (stringList.size() == stringSet.size()) {
        System.out.println("没有重复元素");
    } else {
        System.out.println("有重复元素");
    }
}

// 2.使用jdk8的Stream来判断
public static void main(String[] args) {
    List<String> stringList=new ArrayList<>(Arrays.asList("a","a","b","c"));
    long count = stringList.stream().distinct().count();
    if (stringList.size() == count) {
    System.out.println("没有重复元素");
    } else {
    System.out.println("有重复元素");
    }
}

// 3.实际开发场景中,需要判断重复的元素可能在对象集合中每个对象的某个成员变量中，可以用jdk8的Stream很方便的获得想要的成员变量的集合，再判断是否有重复元素。
public static void main(String[] args) {
    List<Person> personList = new ArrayList<Person>(){{
        add(new Person("张三"));
        add(new Person("李四"));
        add(new Person("张三"));
    }};
    List<String> stringList = personList.stream().map(Person::getName)
        .collect(Collectors.toList());
    long count = stringList.stream().distinct().count();
    if (stringList.size() == count) {
        System.out.println("没有重复元素");
    } else {
        System.out.println("有重复元素");
    }
}

// 4.个人实战举例
if (this.calculateRuleDetailList.size() != this.calculateRuleDetailList.stream()
    .map(CalculateRuleDetailSaveRequestDTO::getItemName).collect(Collectors.toList()).stream().distinct()
    .count()) {
    throw new ParameterException("计算明细条目名称重复!");
}
```

### 分页处理

```
// 分页处理 [ skip：跳过n个元素，limit裁剪大小，pageNo 当前页，pageSize当前页大小。]
list = list.stream().skip((pageNo - 1) * pageSize).limit(pageSize).collect(Collectors.toList());
```
