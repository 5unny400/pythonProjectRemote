# 秒杀下单

### 库存超卖

#### 问题

> https://www.processon.com/view/6344c9826376891c6b4ce070

![redis-秒杀下单-库存超卖.png](images/redis-秒杀下单-库存超卖.png)

#### 解决 - 加锁

- 悲观锁：操作数据之前就拿到锁，让线程串行执行，`Synchronized`、`Lock`等
- 乐观锁：更新数据时才判断数据有没有被其他线程修改

##### 乐观锁 - `版本号`

| id  | stock | version |
|-----|-------|---------|
| 1   | 1     | 1       |

![redis-秒杀下单-库存超卖-乐观锁-版本号.png](images/redis-秒杀下单-库存超卖-乐观锁-版本号.png)

##### 乐观锁 - `CAS`

![redis-秒杀下单-库存超卖-乐观锁-CAS.png](images/redis-秒杀下单-库存超卖-乐观锁-CAS.png)
