# 集群伸缩

```shell
# 查看相关命令
docker exec -it redis-6381 redis-cli --cluster help
```

### 需求分析

需求：向集群中添加一个新的master节点，并向其中存储 num = 10

- 启动一个新的redis实例，端口为6388
- 添加6388到之前的集群，并作为一个master节点
- 给6388节点分配插槽，使得num这个key可以存储到6388实例

这里需要两个新的功能：

- 添加一个节点到集群中
- 将部分插槽分配到新插槽

### 实例操作

#### 1、添加新节点到redis

```shell
# 需先创建一个新的redis实例哦
# docker-compose -f docker-compose-redis-cluster.yml -p redis up -d redis-6388

# 让6388加入集群，并且默认是一个master节点
docker exec -it redis-6381 redis-cli -a 123456 --cluster add-node redis-6388:6388 redis-6381:6381
```

查看集群状态：

```shell
docker exec -it redis-6381 redis-cli -p 6381 -a 123456 cluster nodes
```

![redis.png](images/redis-cluster-add-node-01.png)

但6388节点的插槽数量为0，因此没有任何数据可以存储到6388上

#### 2、转移插槽

我们要将num存储到6388节点，因此需要先看看num的插槽是多少

![redis.png](images/redis-cluster-add-node-02.png)

可以看到num的插槽为2765

我们可以将0~3000的插槽从6381转移到6388

```shell
docker exec -it redis-6381 redis-cli -a 123456 --cluster reshard redis-6381:6381
```

![redis.png](images/redis-cluster-add-node-03.png)

查看6388节点数据

![redis.png](images/redis-cluster-add-node-04.png)
