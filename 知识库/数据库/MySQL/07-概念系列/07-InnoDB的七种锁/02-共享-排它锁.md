# 共享/排它锁(Shared and Exclusive Locks)

行级锁，S锁与X锁，强锁；

1. 事务拿到某一行记录的共享S锁，才可以`读取`这一行；
2. 事务拿到某一行记录的排它X锁，才可以`修改`或者`删除`这一行；

![共享排它锁兼容互斥表.png](./images/InnoDB共享排它锁兼容互斥表.png)

即：

1. 多个事务可以拿到一把S锁，`读读可以并行`；
2. 而只有一个事务可以拿到X锁，`写写/读写必须互斥`；

共享/排它锁的潜在问题是，不能充分的并行，解决思路是数据多版本

```
CREATE TABLE `t2` (
  `id` int(10) NOT NULL,
  `name` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

insert into t2 values(1,1);
insert into t2 values(2,2);
insert into t2 values(3,3);
```

事务A处理

```
-- 开启事务A
START transaction ;

insert into t2 values(4,4);

-- 然后在另外一个连接事务B中执行插入查看数据隔离
select * from t2;

-- 这对于事务A来说，事务B已经插入id为5的数据，这里就会失败
insert into t2 values(5,5);


-- 提交事务
COMMIT;
```

事务B处理

```
-- 在RR的隔离级别下，不可能读取到还未提交事务A生成的数据。
select * from t2;

insert into t2 values(5,5);
```
